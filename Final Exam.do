* Data Management Project- Final Project
* Shibin Yan Sulman Saleem, Fall 2019
* Revised: Fall 2019 Dec.15
*----------------------------

//---------------------------data mgmt----------------------------------------------
//---------------------------data mgmt----------------------------------------------
//---------------------------data mgmt----------------------------------------------

/*****************/
/* Introduction */
/*****************/

/* Literature Review
Geographic health disparity is widespread in China, especially evident in the 
older population. A lot of interesting studies have demonstrated that older 
people from urban areas can access more health care resources than their rural 
counterparts (Rodgers, 1979; Feng &amp; Yu, 2007; Evandrou et al., 2014; Li et al., 2018). 
Some claim that the unequal distribution of health resources is a major contributor 
Hsiao, 1995; Kanbur &amp; Zhang, 2009; Li et al.,2018). Health resources, such
as community health centers, health facilities, nursing homes, professional 
doctors are concentrated in urban settings. Numerous health programs for elderly 
which are funded by local governments are located in urban areas. Generally, the
urban elderly receive high-quality health service. In contrast, older people in 
rural area confront many barriers to access to health service. One of the 
barriers is that the caregivers are unwilling to work in rural areas due to the 
impoverished living conditions (Yang et al., 2012). Other barriers are worsening 
income inequality between these two regions (Grossman, 1972; Rodgers, 1979; 
Wilkinson, 1996;Subramanian &amp; Kawachi, 2004; Feng &amp; Yu, 2007). It is 
known that both income growth and income inequality influence an individual’s 
health condition (Grossman, 1972; Feng &amp; Yu,2007). The income per person in 
the urban region is higher than that of the rural region. According to the 
National Bureau of the statistic of China, per capita disposable income in rural
households is $1945 while $5272 in the urban household in 2017 (NBS, 2017). With
less financial support, the health resource that distributes to rural elderly is
very limited. Moreover, compared to urban elderly, rural elderly are lack of 
pension and have to pay higher compartment of service, which keep them away from 
the better senior care service. According to the National Bureau of the 
statistic of China in 2017, about 60% of rural elders cannot access adequate health
care service because of the financial issue (NBS, 2017). Many of them are more 
likely to receive self-treatment rather than inpatient service than urban 
counterparts (Wang, 2014). China has 56 official ethnic groups—55 ethnic minority 
groups and the Han majority. According to the 2010 Chinese Census, the dominant 
Han makes up 91.51% of the total population and 55 ethnic minority groups just 
account for 8.49% (NBS, 2010). The ethnic minorities are different from  the Han 
majority on culture, customs, genetic backgrounds, geographic location and 
languages (Guan, 2015). Because of historical reasons, the ethnic minority 
communities are more concentrated in the mountain area where economic development 
is hindered (Ouyang &amp; Andersen, 2012; Liu et al., 2007; Cao 2010 ). Plus, to
support the ethnic minority communities, the Chinese government has set up five 
minority autonomous regions, which has the highest minority ethnic population. 
In addition, with the rapid development of Chinese economic, the income gap 
between the Han majority and the minority have widened since the unbalanced
regional economic growth in China (Gustafsson et al., 2003). Constraint by 
finance, ethnic minorities that tend to live in the less developed geographic 
region has poorer health status than
the Han majority (Liu, 2007).
*/ 


/* Data Description 
Data came from the Chinese Longitudinal Healthy Longevity Survey (CLHLS), released by 
the National Archive of Computerized Data on Aging in 2017. The CLHLS surveys 
include seven waves of data which are released in 1998, 2000, 2002, 2005, 2008, 2010 
and 2014 respectively. The CLHLS provides information on health status and quality of 
life of the elderly aged 65 and older in China,included socioeconomic characteristics, 
family, lifestyle, and demographic profile of this aged population. A national representative 
sample of people aged 65 or older was drawn. The dataset covers 23 out of 31 provinces in China, 
including five minority autonomous regions. These minority autonomous regions that have
a much higher proportion of minority group concentration are Guangxi, Inner Mongolia,
Ningxia, Xinjiang, and Tibet. In this study, the data from the 2014 wave of the CLHLS
surveys will be utilized because it is easy to observe the effect of the health disparity
on the older population in one dataset. The study sample consists of 7,192 older adults
aged 65 and over; 7% (n=495) of them are ethnic minorities. In addition, it comprises
3,214 urban elderly which accounting for 44.6% of the sample and 3,980 rural elderly.
The response rate was 97.7 percent.   
*/

/* Research Goal
This research is about health disparity for the Chinese elderly. This research aims to 
find out how geographic and ethnicity of residents affect collectively on health quality of old 
people in China. In other words, this study will assess the impact of geographic 
and ethnicity disparity on the health outcome of the Chinese elderly.
*/

/* Research Question
1. Does the majority elderly have a better health status than their minority 
counterparts, as the literature showed? 
2. Does the elderly living in the urban area live longer than their counterparts 
in the rural area?
*/

/* Hypothesis 
Hypothesis 1: The Han (majority) elderly living in an urban area have a better 
health status than those in a rural area. 
Hypothesis 2: The Han (majority) elderly living in an urban area have a better 
health status than the minorities in an urban area. 
Hypothesis 3: The Han (majority) elderly living in a rural area have a better 
health status than the minorities in an urban area.
Hypothesis 4: The minority elderly living in an urban area have a better health 
status than those in a rural area.
*/

/* Variables 
Independent Variables: age,education,income and employment status. 
* Justification of use these variables: Health disparity is not simply related 
to differences in health. The fundamental-cause theory insists that socioeconomic 
status is a fundamental cause of health disparity. Disparities in health have 
persisted in developed countries and groups who experience some of the greatest 
disparities in health tend to experience the greatest socioeconomic disparities. 
Shavers argues that SES is a significant contributor to the disparate health 
observed among ethnic groups in different regions (rural/ urban). Based on 
Shaver’s model, the study measure SES included occupation, income, and education.
 Using this model, the socioeconomic status of the ethnic group of elderly from 
 urban/ rural areas are the independent variables. 

Dependent Variables: self-rated health status,functional capacity (ADLs& IADLs) .
functioning capacity was assessed by the Activities of Daily Living (ADL) and 
the Instrumental Activities of Daily Living (IADL)which were adapted to evaluate 
an older individual’s ability status in the daily life (Tang et al., 1999; Yi & Vaupel, 2002). 
The data on ADL and IADL is available on the CLHLS. There are 13 questions on 
ADL and 15 questions on IADL in the survey. ADLs are measured by six areas, 
including dressing, toileting, Indoor transfer, continence, cooking, and eating. 
Similarly, the measurement of IADLs includes meal preparation, laundry, sweeping,
carrying 10 kg objects, and walking 1km. For example, respondents would be asked 
“Can you lift a weight of 5kg, such as a heavy bag of groceries?” and they can choose 
the answers from “yes, independently”, “yes, but need some help” to “no, can’t”.  
Control Variables: gender, marital status, family size. The Controls will include 
the factors that would have an impact on the relationship between ethnic and 
geography health disparity and the health status of the Chinese elderly.
 These control variables are variables: gender, marital status, family members.  
*/

/* Results
This study aims to assess the impact of geographic (urban/rural) and ethnicity 
disparity on the health outcome of the Chinese elderly. On the basis of data 
analysis, it seems that Chinese elderly's health are more likely to be affected
by geographic (urban/rural)disparity and ethnicity. SES indicator is a reliable 
measurment of health disparity. We finds that different components of SES measures 
may not produce the same benefit to all ethnici groups. Han, as a majority, 
benefit the most fromhealth resource unbalanced distribution.Turning to another 
health disparity, the SES indicator shows that rural elderly have better health 
status than urban elderly, which is out of our expected. We looked deeper on the 
relationship between rural/urban difference and health conditions of the elderly. 
We finds that happiness and famliy size are statiscally significant affecting
elderly's health. One possible explanation is that elderly become happy to get 
close to the natural enviornment in rural areas, which in turn improve their 
health status. In conclusion, geographic and ethnicity health disparity exist
in current China and have great impact on elderly's health. More things should 
be done by the Chinese government to reduce the health disparity and
make health distribution more equable. 
*/


/* Limitations
This study is the first to explore the impact of geographic and ethnic health 
disparity on the health of the Chinese elderly. As exploratory research, 
there are limitations that need to be identified. First, despite the CLHL surveys 
included data on five minority autonomous regions, but the sample size 
from these regions are small. Only 7% of the sample is reported as an ethnic 
minority. The small sample size would compromise the representativeness of the 
sample and decrease the internal validity of the research.  Internal validity 
cannot be established since the findings may not be generalized to other settings 
because of the small sample size (Bhattacherjee, 2012). Consequently, our findings 
might not apply to the large ethnic population. Second, health disparity is a 
complex issue, and the measurement of health disparity is a big challenge for 
the study. Even though SES is commonly used as the measurement of health 
disparity, the concept of SES includes a variety of factors, such as children 
income level, parents income. It is insufficient to apply a few factors to measure health 
disparity (Dehlendorf et al.,2010). Simplification of the health disparity cannot 
reflect the complexity of the reality in the ethnic and geographical health 
disparity among Chinese elderly. 
*/

/* references 
*1. Chinese Longitudinal Healthy Longevity Survey:
 (https://www.icpsr.umich.edu/icpsrweb/NACDA/studies/36692)
*2. Tung, Ho-Jui, and Elizabeth J. Mutran. "Ethnicity and Health Disparities 
Among the Elderly in Taiwan." Research ///
on Aging27, no.3(2005): 327-354.
*/

//////////////////////Project Start////////////////////////
clear
set more off
version 15
//////////////////////////////////////////////////////////


//////////////////////Package Install////////////////////////

net install outreg2, from(http://fmwww.bc.edu/RePEc/bocode/o) 
*net install regplot, from(http://www.stata-journal.com/software/sj10-1/) 
*net install reverse, from (http://fmwww.bc.edu/RePEc/bocode/r) 
//////////////////////////////////////////////////////////

/********************/
/* data cleaning*/
/********************/

use "https://docs.google.com/uc?id=1Sb_fGGdRiVSxFpcfHbp7RaV2QauGxi_q&export=download",clear
* some variable names get people confused. It would be better to rename these variables.
rename TRUEAGE age14
rename RESIDENC rural14
rename A1 sex14
rename A2 ethnic14
rename B27 happiness14
rename F41 marital14
rename A41 born14
rename B12 health14
rename F35 income14
rename F23 employment14
rename F1 education14
rename A52 familysize14
rename D71 smoking14
rename E1 bathing14
rename E2 dressing14
rename E3 toileting14
rename E4 transfer14
rename E5 continen14
*E1 to E5 is the variables which use to measure the elderly's activities of daily living (ADLs).
rename E6 feeding14
rename E7 visiting14
rename E8 shopping14
rename E9 cooking14
rename E10 washing14
rename E11 walking14
rename E12 carrying14
*E6 to E14 is the variables used to measure the elderly's instrumental activities of daily living (IADLs).

local idvar ID YEARIN MONTHIN DAYIN TYPE PROV
display "`idvar'"
keep  age14 rural14 sex14 `idvar' ethnic14 happiness14 marital14 born14 health14 income14  employment14 education14 ///
familysize14 smoking14 bathing14 dressing14 toileting14 transfer14 continen14 feeding14 visiting14 shopping14 ///
cooking14 washing14 walking14 carrying14 A542A

* Factor Analysis 
factor feeding14 visiting14 shopping14 cooking14 washing14 walking14 carrying14 bathing14 dressing14 ///
toileting14 transfer14 continen14,ipf factor(2)
rotate, varimax horst
predict factor1 factor2
rename factor1 ADLs
rename factor2 IADLs 
egen function14 = rowmean(ADLs IADLs)
* function14 is the dependent variable which measure the functioning capacity of the elderly. 

* recode the rural variable
recode rural14 (3=0 "rural") (1 2=1 "urban") (-99=.),gen(Urban14) 

* recode the ethnicity variable
recode ethnic14  (1=0 "majority") (2 3 4 5 6 7 8=1 "minority"),gen(major14) 

recode marital14 (2 3 4 5=0 "single") (1=1 "spouse"), gen(spouse14)

* flip the health variable, make 5 the best outcome of health, 1 the worst outcome. rev_health14 is recode variable of health14.
recode health14 (5=1 "very bad") (4=2 "bad")(3=3 "so so")(2=4 "good") (1=5 "very good")(8 9 .=.),gen(rev_health14) 
codebook rev_health14
/// need to rename health variable to change the way it label.
/* we tried the revrs command. however, it doesn't work well. When it reverses the 
value order of health variable, 1 is "missing" rather than "very bad" .*/ 
save eldmain.dta, replace


* the second dataset
use "https://docs.google.com/uc?id=1_exDjt1Rbc1B18wX0oMgyRZeWpm04uKH&export=download",clear
rename TRUEAGE age12
rename RESIDENC rural12
rename A1 sex12
rename A2 ethnic12
rename B27 happiness12
rename F41 marital12
rename A41 born12
rename F35 income12
rename B12 health12
rename F1 education12
rename F23 employment12
rename A52 familysize12
rename D71 smoking12
rename E1 bathing12
rename E2 dressing12
rename E3 toileting12
rename E4 transfer12
rename E5 continen12
*E1 to E5 is the variables which use to measure the elderly's activities of daily living (ADLs).
rename E6 feeding12
rename E7 visiting12
rename E8 shopping12
rename E9 cooking12
rename E10 washing12
rename E11 walking12
rename E14 carrying12
*E6 to E12 is the variables used to measure the elderly's instrumental activities of daily living (IADLs).

local idvar ID YEARIN MONTHIN DAYIN TYPE PROV
display "`idvar'"
keep `idvar' age12 rural12 sex12 ethnic12 happiness12 marital12 born12 health12 income12 /// 
employment12 education12 familysize12 smoking12 bathing12 dressing12 toileting12 transfer12 ///
continen12 feeding12 visiting12 shopping12 cooking12 washing12 walking12 carrying12 A542A
save eldsed.dta, replace

/*****************/
/* Merging data*/
/*****************/

/*merge1*/ 
use eldsed, replace
sort ID
destring A542A, replace
merge 1:1 ID using eldmain.dta
save clhwave.dta,replace
sort _merge
list TYPE if _merge==1
list TYPE if _merge==2
/*
the reasons for the non-merge is that there are thousands of new observations added to 
the using datasets, and that many observations appeared in the master dataset are not 
longer appear in the using dataset. Maybe it is because the elderly died or the researchers
cannot find these elderly for an interview again.  
*/

/*merge2*/
use "https://docs.google.com/uc?id=13lo_bsO5ur70VJiZXx6pNdY67AHVbLTH&export=download",clear
keep ID MONTHIN DAYIN TYPE PROV age08 rural08 sex08 ethnic08 happiness08 marital08 born08 health08 income08 /// 
employment08 education08 familysize08 smoking08 bathing08 dressing08 toileting08 transfer08 continen08 feeding08 visiting08 shopping08 cooking08 washing08 walking08 carrying08 
merge 1:1 ID using clhwave,nogen
save chclthr.dta,replace
list ID TYPE if _merge==1
list ID TYPE if _merge==2
/*
The reasons for the non-merge is that there are thousands of new observations added to 
the using datasets, and that many observations appeared in the master dataset are not 
longer appear in the using dataset. Maybe it is because the elderly died or the researchers
cannot find these elderly for an interview again.  
*/
*/

/*merge3*/
use chclthr.dta,clear
decode PROV, g(PROV1)
replace PROV1 = proper(PROV1)
save giant, replace
import excel "https://docs.google.com/uc?id=14owWYRQ4O8GYwoN8VWVsyUyY1ke9KlwF&export=download", sheet("Sheet1") firstrow clear
keep in 1/31
rename PROV PROV1
merge 1:m PROV1 using giant, nogen 
save yearmge, replace 
sort _merge
list PROV1 if _merge==1
list PROV1 if _merge==2
list PROV1 if _merge==1 | _merge==2
/*
The reason for the non-merge is because there is different way to spell the name of
province name between the master dataset and using dataset, such as Shannxi and 
Shaanxi.
*/
* Data from China Statistical Yearbook 2018 http://www.stats.gov.cn/tjsj/ndsj/2018/indexeh.htm.

/*merge3*/
use "https://docs.google.com/uc?id=1WMOXBRM8910rlTr3VV3uFCXPtuT5LRmC&export=download",clear
keep if COUNTRY==1 | COUNTRY==10 | COUNTRY==22  
keep COUNTRY RESIDENCE PROVINCE_CHNS AGE INCOME PPP GOODHEALTH BMI
ren PROVINCE_CHNS PROV
decode PROV, gen(PROV1)
replace PROV1 = proper(PROV1)
collapse (mean) AGE , by(PROV1)
save agemeg,replace
/*Data from Research on Early Life and Aging Trends and Effects: A Cross-National 
Study 1996-2008 https://www.icpsr.umich.edu/icpsrweb/DSDR/studies/34241.*/
merge 1:m PROV1 using yearmge, nogen
sort PROV1
save healthwho, replace
*list PROV1 if _merge==1 | _merge==2
/* A lot of non-merge happen in the using dataset because there are a lot of 
missing value of PROV1 variable in  the using dataset. */

/*merge5*/
use "https://docs.google.com/uc?id=1jrGlyM9tmOy9OtILTxuLnJhJuqgPdTvC&export=download",clear
rename Q0104 rural12
rename Q0811 educ
recode educ (-8=.)
egen averural=mean(educ), by(rural12)
collapse educ, by(rural12)
save chrural,replace
merge 1:m rural12 using healthwho, nogen 
list rural12 YEARIN if _merge==1
list rural12 YEARIN if _merge==2
* Data from WHO Study on Global AGEing and Adult Health 2007-2010 https://www.who.int/healthinfo/sage/en/.
/* The data of rural variable come from two different year. One is from 2012, 
another is from 2014. I merge the data with rural14. The non-merge occur because
of I did not merge the data with rural variable from 2012.*/


/********************/
/*descriptive statistics*/
/********************/
use healthwho, clear
bys marital14: egen maxage14=max (age14)
la var maxage "maximums marital elderly age"
/* creat the maximum marital elderly age. By doing this, we can know the largest age of
elder people in different marital status groups. The result shows that 62 widowed elderly's
age is 108, which count as the maximum age in their group. */
ta maxage14 marital14

bys ethnic14: egen meanage=mean(age14)
/* we would like to know the mean of elderly age from different ethnicity groups. So we creat
the meanage14 variable. The result shows that 97 Han majority people live as long as 89 years.
 */
la var meanage "mean elderly age"

tab rural14
//Shows the break down of the interviewee's geograpic location
tab age14
//Gives break down of how many people are there by age. 

tab ethnic14
//Break of ethnicity and it appears that han is where 94% of interviewee are from

graph pie [pweight = rural14], over(rural14) sort(rural14)
*Breakdown of population in pie chart. 

sum age14
*average age 85

tabstat rev_health14 income14 education14 employment14 , by(rural14) 
tabstat rev_health14 income14 education14 employment14 , by(rural14)  nototal long col(stat)

///Using outreg2 to export summary statistics of all variables in dataset.
outreg2 using des.doc, replace sum(log) keep(rev_health14 function14 rural14 ethnic14 ///
age14 income14 education14 employment14 smoking14 marital14 familysize14 sex14)

///remember that 99 or 999 is the number for missing value. Sometimes we need to take care of it. 


/*****************/
/* Visualizing data*/
/*****************/

graph bar (mean) rev_health14, blabel(bar) by(rural14, total) title(Mean Region Health)
/* This is a very important graph. It suggest that people who live in urban areas
self-reported better health than those who are living in rural and town. */

graph bar (mean) rev_health14, over(major14) blabel(bar) by(rural14, total) title(Majority vs Minority)
 /*  Han (majority) elderly living in an urban area  have better 
health status than the minorities in an urban area. Third hypothesis states that 
the Han (majority) elderly living in a rural area have a better health status 
than the minorities in an urban area--that is true as well but marginal differnce.
The minorities elderly living in an urban area do not have a better self-health 
status than those in a rural area- it is the opposite in which rural minority are
doing better. Note the interpretation are purely based on graph and may be 
diffrent if we run regression. Also it is pertinent to mention that frequency is 
diffrent for the rural and urban participant so it may have an impact on the 
mean of the variables. */
 
graph bar (count), over(major14) blabel(bar) by(rural14, total)
/*Where does majority predominatly lives? Primarily rural area.
According to the graph there are only 495 people out of sample of 6635 people.
That is fine as according Chinenese census data minority are only 
8.49% of the population (NBS Census, 2010). In our data over 7% of the people are 
minority. */

graph box age14, over(ethnic14)title(Age Dispersion By Ethnicity)
/*clever graph with age dispersion by ethnicity. Han appears to have the largest
age dispersion while Korean and Mangolian appear to have smallest disperion
that is understandble as there is only one Koreans  ...COOL.*/ 

*Start to visualize the data 
hist age14, frequency normal
/* Age of the people in this data appears to have normal distribution. This is important
because of central limit theorem. In simple terms if you have many independent 
variables that may be generated by all kinds of distributions, assuming that 
nothing too crazy happens, the aggregate of those variables will tend toward a 
normal distribution.*/
gr export graph1.png, replace  

hist income14,normal
gr export graph2.pdf, replace 

graph hbar (count), over(sex14)  by(rev_health14, total)
/*Self-reported health by sex...females reported better health in the agregate
it is well known that female play major role in caregiving perhaphs that has a positive
impact on their health. */
gr export graph11.png, replace  


graph hbar rev_health14, over(PROV) bargap(50) title(Self-reported health by provinces)
/*Mean of self-reported health by provinces...most provinces self-reported health
above or at 3. Cool */
gr export graph17.png, replace  

histogram rev_health14, discrete frequency lcolor(magenta) lalign(outside) horizontal ///
addlabel by(, title(Overall Self-Reported Health)) by(rev_health14)
/*Here we see the breakdown of self-reported health their respective breakdown 
Mostly so so and good. Cool*/

histogram rural14, discrete frequency lcolor(magenta) lalign(outside) horizontal ///
addlabel by(, title(Population Breakdown)) by(rural14, total)
*Where are the participants from? Mostly rural area.
gr export graph4.png, replace  

scatter income14 education14 if education14 < 60 || lfit  income14 education14 if ///
education14 < 60, title(Income and EDU Relationship)
*Does education has impact on income? Yes it is and that is what we expected. 
gr export graph7.png, replace  

graph bar (count), over( employment14) title(Are you still enaged in paid job after retiring?)
*Are most people engaed in paid job after retiring? NO
gr export graph8.png, replace  

*Group Statistic 
tab rural14, sum (age14)
* Coincdently average age for the interviewees is 85 in rural, urban and towns.  

tab ethnic14, sum (age14)
/*Range of the participants on average is 84-89. 'Man' being highest at 89 and 
'Others' beings 84 the lowest. */

tab rural14, sum (rev_health14)
/*City residents appears to have reported the best health followed by town and 
then the rural. */

twoway histogram rev_health14 , discrete freq by(rural14) 
/*Participants self-reported health by region. It appears that most people
answered 'so so' and 'good'. */
gr export graph13.png, replace  

twoway histogram age14 , discrete freq by(rural14) by(rural14, total), normal
gr export graph14.png, replace  

histogram age14, normal
/* It gives the age distribution and it appears mean of age is around 85. Senior
citizen age distribution appears normal. */

twoway histogram age14 , discrete freq by(ethnic14)
/* It gives age histogram which somewhat gives perspective about age distribution.
Not the best of the graph but it gives perspective about age distribution */
gr export graph14.png, replace  

tw(scatter rev_health14 age14)(lfit rev_health14 age14), title(Age and Health)
/* It appears the relationship between health and age is negative. In other words, 
the elderly people get they worse health they reports. This is as expected. */

twoway(scatter rev_health14 age14) if age14>65|| lfit rev_health14 age14, title(Age and Health Assocation Over 65)
/* It appears relationship between health and age is negative even if age is set to 
be greater than 64. In other words, the elderly people get they worse health they
 reports. This is as expected. */

twoway (scatter rev_health14 age14) if age14>65, ylabel(, labsize(small)) ///
by(, title(the relationship between health and age regionally)) by(, legend(on)) by(rural14, total)
gr export graph25.png, replace  

twoway (scatter rev_health14 familysize14) if familysize14<65 || lfit rev_health14 familysize14
/* Interesting graph that gives perspective number of people living in the home 
and self-reported health. It appears that the relationship is visually flat.
I wonder if that would be the case if a correlation test is is run.
*/

histogram age14, discrete freq by( ethnic14 , total) 
/* It appears that the total population is normally distributed. That is great for
for our reseach. */ 

graph matrix rev_health14 age14, by(ethnic14, total)
gr export graph141.png, replace  

graph matrix rev_health14 income14 education14 employment14, half maxis(ylabel(none) xlabel(none))
gr export graph24.png, replace 

graph matrix function14 income14 education14 employment14, half maxis(ylabel(none) xlabel(none))
gr export graph25.png, replace  

/*****************/
/* Regression */
/*****************/
/// use pwcorr & corr command to check the correlation between the variables that we are using.
pwcorr rev_health14 function14 sex14 age14 education14 income14 employment14, star(.05)
corr rev_health14 age14 education14 income14 employment14

/// What's the main determinants of elderly's health?
local control smoking14 marital14 familysize14 sex14
local varin income14 education14 employment14 age14
display "`control'"
display "`varin'"


foreach s in "rural14 "  "rural14 ethnic14" "rural14 ethnic14  income14 education14 employment14"{
	reg rev_health14 `s'
	outreg2 using reg15.doc

}

reg rev_health14 rural14,robust 
reg rev_health14 rural14 ethnic14,robust 
reg rev_health14 rural14 ethnic14  income14,robust  
reg rev_health14 rural14 ethnic14  income14 education14 employment14,robust 
reg rev_health14 rural14 ethnic14  `varin',robust 
reg rev_health14 rural14 ethnic14  `varin',robust  
reg rev_health14 rural14 ethnic14  `varin' `control' , robust
predict health_predict
label variable health_predict "health predicted"
scatter rev_health14 health_predict
///use predictor values to see how well the model is!
outreg2 using reg9.doc, onecol bdec(2) st(coef) excel append ct(A3) lab
/* 
We expected to find, as stated in the hypothesis earlier, that income, education 
and employment predict greater health. Income, education & employment are proxy of 
the health disparity. A4 model in the regression table 
tells us that the relatonship between health disparity and health status is 
statistically significant. There is positive relationship between these variables.
In other words, the higher the income, education level the more likely elderly 
are like to have a better health. It support the statement from literature that 
socioeconomic status (income, edution, employment)are the determint factor of health. 
A5 model add ethnicity and geography. We can see that both ethnicity and gepgraphy have
substantial ans statiscally significant effect on health. A9 adds other predictors
of health as controls and ethnicity effect on health decrease. In addition, 
holding other control variable constant, the effect of famioy size is surprisingly negative! 
In other words, the more people that elderly live with, the worse their health, 
which is opposite with the literature. 
*/

/// check what's the main determinants of elderly's functioning capacity?
local control smoking14 marital14 familysize14 sex14
local varin income14 education14 employment14 age14
reg function14 rural14,robust 
reg function14 rural14 income14,robust 
reg function14 rural14 income14 education14 employment14,robust 
reg function14 rural14 `varin',robust 
reg function14 rural14 `varin' `control' , robust
outreg2 using reg30.xls, onecol bdec(2) st(coef) excel append ct(A6) lab
/* 
functioning capacity is another proxy of health status of the elderly. We expect 
to see that health disparity greately affect functioning capacity of the elderly. 
In A5 column, geographic location and income have more effect on functioning 
capacity of the elderly, as we expected. In A9 column, when we added all predictor 
variable together, we can find that geographic location, smoking and marital 
status have a statistical significant effect on functioning capacity. One thing 
out of our expectation is that the relationship marital status and functioning 
capacity tend to have a better health! 
*/

///compare the health status of elderly from different areas to see how geographic location difference affect health.
xi: regress rev_health14 i.rural14 ethnic14 income14 education14 employment14 smoking14 marital14 familysize14 sex14,robust
rename _Irural14_2 town
rename _Irural14_3 rural
label variable town "town"
label variable rural "rural"
outreg2 using reg11.xls, replace
/* 
We expect to see that elderly living in city have better health than their 
counterparts in rural area. The literature show to us that older people from 
urban areas get better health than elderly in rural because they can access more
health care resources than their rural counterparts.Quite opposite, in the 
regression table, elderly in rural area have 0.123 more unit increase on health
compared to elderly in city, holding other variables constant. The elderly in 
rural area have better health than the elderly in the city. It is so surprise 
outcome! Maybe it is related to happiness and pollution and environment. We will 
look deep in the data. And we don't find correlation between the health of elderly 
in town and the health of elderly in rural. 
*/
///problem: why the lable of variables did not show in the outreg table?

/* Checking why the elderly in rural area have better health than the elderly in 
the city. Maybe happiness contribute to that outcome.*/
xi: regress rev_health14 i.rural14 ethnic14 income14 education14 employment14 happiness14 smoking14 marital14 familysize14 sex14 age14,robust
outreg2 using reg12.doc, replace
graph bar (mean) happiness14, over(rural14)
gr export graph155.png, replace
eststo model2
esttab, r2 ar2 se scalar(rmse)
predict rev_health14_predict
scatter rev_health14 rev_health14_predict
/* 
From the regression table, we can see that happiness/ Subjective well-being (SWB)
have a significant effect on health of elderly.  And then, we can find that elderly 
in rural report a better health than their counterparts in town and city! According to 
Dr.Adam's SWB theory, nature envrionment make people happier. So elderly in rural a
reas get more chance to exposure to nature  enviornment than their counterparts in city. 
So they tends to become happier. 
*/

/// look deep on the strong relationship between health and income.
gen logincome = log(income14) 
save healthfinal.dta, replace
gen income14_1 = income14/10000
regress rev_health14 rural14 ethnic14 logincome education14 employment14 smoking14 ///
marital14 familysize14 sex14 age14,robust
regress rev_health14 rural14 ethnic14 income14_1 education14 employment14 smoking14 ///
marital14 familysize14 sex14 age14,robust
* use log to make income value to be smaller, so we can observe the effect of income easily. 

///////////////////////////// Interaction ////////////////////////////////

/* We argue that the ethnic division between these two groups reflects their historical and
sociostructural standing in society and shapes their life experiences. If so, by 
exploring the interactions between the elders’sociostructural positions and health 
across ethnicity, additional insights into the mechanisms of social inequalities 
in health might be obtained.
*/

/*
Closer scrutiny on the ethnic patterns of health disparities and interactions between 
ethnicity and elders’sociostructural positions to health may lead to a better understanding 
of social inequalities in health.
*/


xi: regress rev_health14 i.ethnic14 Urban14 logincome education14 employment14 smoking14 marital14 familysize14 sex14 age14,robust
outreg2 using reg13.doc, replace
/* 
As we stated in hypothesis, we expect to see that the Han (majority) elderly living 
have a better health status than the minorities. Regression table shows us that 
Zhuang minority group have worst health, compared to the majority. This is not 
surprise. However, it also reveals that mongolia and other ethnic group have a 
better health than majority. This is out of our expectation. The data tells us 
that some ethnic group do better than majority on health but some don't. We need 
to know the reason of that. 
*/

reg rev_health14 Urban14 i.ethnic14 Urban14#ethnic14 logincome education14 ///
employment14 smoking14 marital14 sex14 familysize14 age14,robust 
outreg2 using reg29.doc

reg rev_health14 i.ethnic14##c.logincome, baselevels
reg rev_health14 ethnic14 logincome i.ethnic14##c.logincome, robust
reg rev_health14 ethnic14 logincome i.ethnic14##c.logincome i.ethnic14##c.education14 ///
 i.ethnic14##c.employment14 smoking14 marital14 sex14 familysize14 age14, robust
/* 
We expected to see the urban/rural health disparity among the elderly. Here, we use income, education and  employment to measure health disparity. Using interaction between these variables, we can find that interaction effect of urban employment on health is significant, controled for other variables. In other words, ethnic health disparity do exist among elder population. It support our 
hypothese that majority elderly have better health than minorities elderly.  
*/

reg rev_health14 Urban14 logincome i.Urban14##c.logincome i.Urban14##c.education14 ///
i.Urban14##c.employment14 smoking14 marital14 sex14 familysize14 age14, robust
outreg2 using reg21.doc,replace 
/* we can know that the interaction between residence location and employment is statiscally
significant. As we expected, eldely living in urban areas have better health status than 
their rural counterparts. It seems that residence location do matter because it can affect  
elderly's health. It also support our hypothese that urban elderly have better
health condition thant elderly living in rural area.
*/


// Marginsplot
reg rev_health14 i.rural14##c.income14
margins rural14,  at(income14=(1(100000)900000))
marginsplot, x(income14)
/* It appears the higher the income the better the health. Rise in rural income
has the biggest impact on health realtive it's other regional counter parts. Perhaps
it suggest that $1 invested in rural areas yields better results that its regional
counter parts in town and city. */

reg rev_health14 i.Urban14##c.employment14
margins Urban14,  at(employment14=(1(10)99))
marginsplot, x(employment14)

reg rev_health14 i.ethnic14##c.employment14
margins ethnic14,  at(employment14=(1(5)30))
marginsplot, x(employment14)

reg rev_health14 i.ethnic14##c.familysize14 
margins ethnic14,  at(familysize14=(1(5)30))
marginsplot, x(familysize14)

/*
According to the marginsplot,
*/

// Regplot
reg rev_health14 i. ethnic14
gen ethage = age14 * ethnic14
regress rev_health14 age14 ethnic14 ethage
regplot, by(ethnic14)
regplot, sep(ethnic14)

gen ethage1 = age14 * major14
regress rev_health14 age14 major14 ethage1
regplot, by(major14)
regplot, sep(major14)


// Robust Check
reg rev_health14 logincome , robust
scatter rev_health14 logincome ,ml(ethnic14)


/// Loops
codebook marital14
codebook rural14
levelsof marital14, loc(marital14)
di "`marital'"
levelsof rural14, loc(m1)
levelsof marital14, loc(r1)
foreach m of local m1 {
       foreach r of local r1 {
              tab logincome if marital14 == `m' & rural14 == `r'
       }
}


foreach var of varlist income12 {
  rename `var' `var'20 
}

levelsof marital14, loc(r2)
foreach m of local r2 {
di `m'
}

foreach iv in "rural14 "  "rural14 ethnic14" "rural14 ethnic14 logincome education14 employment14"{
	foreach dv in  rev_health14 function14 {
         reg `dv' `iv'
		 
}
}


foreach dv1 of varlist function14 rev_health14 {
 foreach iv1 in "rural14" "rural14 ethnic14" "rural14 ethnic14 logincome" "rural14 ethnic14 logincome education14" {
 scatter `dv1' `iv1'
 graph export reg50.pdf, replace
 }
 }

 
//-----------------Violation------------------------------------------------
use healthfinal, clear
reg rev_health14 Urban14 
predict Healthhat
graph twoway (scatter rev_health14 Urban14 ) (line rev_health14 Urban14, sort)
graph twoway (scatter rev_health14 Urban14) (lfit rev_health14 Urban14)
reg rev_health14 Urban14 ethnic14 logincome education14 employment14 smoking14 ///
marital14 familysize14 sex14
rvfplot, yline(0)
gr export g1.eps, replace
estat hettest
estat imtest
estat szroeter, rhs
//we can find that there is heteroskedascity in the regression model.


/*****************/
/* Modeling Health*/
/*****************/

*export model1

use healthfinal, clear

reg rev_health14 rural14 
/* *and then export to excel, note eform option that will exponentiate betas; ct will give it column title A1 */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel replace ct(A1) lab
/* *then i run some otjer specification */
reg rev_health14 rural14 ethnic14 
/* *and then export to excel, note eform option that will exponentiate betas; ct will give it column title A1 */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A2) lab
/* *then i run some otjer specification */
reg rev_health14 rural14 ethnic14 logincome 
/* *and then export to excel, note eform option that will exponentiate betas; ct will give it column title A1 */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A3) lab
/* *then i run some otjer specification */
reg rev_health14 rural14 ethnic14 logincome education14 
/* *and outreg2 again but i append instead of replace */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A4) lab  
reg rev_health14 rural14 ethnic14 logincome education14 employment14 
/* *and outreg2 again but i append instead of replace */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A5) lab 
reg rev_health14 rural14 ethnic14 logincome education14 employment14 smoking14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A6) lab  
reg rev_health14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A7) lab
reg rev_health14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14 familysize14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A8) lab
reg rev_health14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14 familysize14 sex14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg5.xls, onecol bdec(2) st(coef) excel append ct(A9) lab
reg rev_health14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14 familysize14 sex14 age14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A10) lab

*export model2
use healthfinal, clear
reg function14 rural14 
/* *and then export to excel, note eform option that will exponentiate betas; ct will give it column title A1 */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel replace ct(A1) lab
/* *then i run some otjer specification */
reg function14 rural14 ethnic14 
/* *and then export to excel, note eform option that will exponentiate betas; ct will give it column title A1 */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A2) lab
reg function14 rural14 ethnic14 logincome 
/* *and then export to excel, note eform option that will exponentiate betas; ct will give it column title A1 */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A3) lab
reg function14 rural14 ethnic14 logincome education14 
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A4) lab  
reg function14 rural14 ethnic14 logincome education14 employment14 
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A5) lab 
reg function14 rural14 ethnic14 logincome education14 employment14 smoking14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A6) lab  
reg function14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A7) lab
reg function14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14 familysize14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A8) lab
reg function14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14 familysize14 sex14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A9) lab
reg function14 rural14 ethnic14 logincome education14 employment14 smoking14 marital14 familysize14 sex14 age14
/* *and outreg2 again but i append instead of replace */
outreg2 using reg6.xls, onecol bdec(2) st(coef) excel append ct(A10) lab

/////////////////////////////////////////END/////////////////////////////////////
